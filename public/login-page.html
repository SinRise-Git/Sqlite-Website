<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div class="main">
        <div class="loginForm" id="loginForm" style="display: block;">
            <h1>Login</h1>
            <form>
                <label for="username">Name:</label>
                <input id="loginUsername" type="text" name="loginUsername">
                <br>
                <label for="loginPassword">Password:</label>
                <input id="loginPassword" type="password" name="loginPassword">
                <br><br>
            </form>
            <div class="loginButtons">
              <button id="loginButton">Login</button>
              <button onclick="showforms('createForm','loginForm')">Create Account</button>
              <button id="checkSession">Check Session</button>
            </div>
            <p id="errorMessageLogin"></p>
        </div> 
        <div class="createForm" id="createForm" style="display: none;">
            <h1>Create account</h1>
            <form>
                <label for="createUsername">Name:</label>
                <input id="createUsername" type="text" name="createUsername" required>
                <br>
                <label for="createPassword">Password:</label>
                <input id="createPassword" type="password" name="createPassword"required>
                <br>
                <label for="createTelephone">Telephone:</label>
                <input id="createTelephone" type="tel" name="createTelephone"required>
                <br>
                <label for="parentsInput">Parents Name:</label>
                <input id="parentsInput" type="text" name="parentsInput"required>
                <br>
                <label for="userOption">Select user type:</label>
                <select id="userOption" name="userOption">
                    <option value="Medlem">Medlem</option>
                    <option value="Leder">Leder</option>
                </select>      
                <br>
                <label for="roleOption">Select your role:</label>
                <select id="roleOption" name="roleOption">
                    <option value="Tamburmajor">Tamburmajor</option>
                    <option value="Trommeslager">Trommeslager</option>
                    <option value="Korpsfanebærer">Korpsfanebærer </option>
                    <option value="Korpssjef">Korpssjef</option>
                    <option value="Medlemmer">Medlemmer</option>
                </select>
                <br> 
                <label for="komaniOption">Select an kompani:</label>
                <select id="komaniOption" name="komaniOption">
                </select>    
            </form>
            <div class="createButtons">
              <button id="createButton">Create Account</button>
              <button onclick="showforms('loginForm','createForm')">Login</button>
            </div>
            <p id="errorMessageCreate"></p>
        </div> 
    </div>
    <script>
        function showforms(show, hide){
            document.getElementById(show).style.display = "block"
            document.getElementById(hide).style.display = "none"
        }
        document.getElementById('checkSession').addEventListener('click', async function(event) {
            event.preventDefault();
            let response = await fetch('/getSession')
        })      

        document.getElementById('loginButton').addEventListener('click', async function(event) {
            event.preventDefault();
            
            const loginUser = {
                name: document.getElementById('loginUsername').value,
                password: document.getElementById('loginPassword').value,
            };

            const requestOptions = {
                 method: 'POST',
                 headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify(loginUser)
            };
            const response = await fetch('/loginUser', requestOptions);
            const data = await response.json();
            if (data.redirectUrl) {
               window.location.href = data.redirectUrl;
            } else {
                document.getElementById('errorMessageLogin').innerText = data.ErrorMessage
            }
        })      

        async function getKompani(){
            let response = await fetch('/getKompani')
            let kompanis = await response.json()
            let kompaniTable = document.getElementById("komaniOption");
            kompanis.forEach(kompani => {
                let option = document.createElement("option");
                option.value = kompani.kompani;
                option.textContent = kompani.kompani;
                kompaniTable.appendChild(option);
            });
        }
        
        document.getElementById('createButton').addEventListener('click', async function(event) {
            event.preventDefault();
            
            const creatUser = {
                name: document.getElementById('createUsername').value,
                password: document.getElementById('createPassword').value,
                telephone: document.getElementById('createTelephone').value,
                parents: document.getElementById('parentsInput').value,
                userType: document.getElementById('userOption').value,
                role: document.getElementById('roleOption').value,
                kompani: document.getElementById('komaniOption').value,
            };

            const requestOptions = {
                 method: 'POST',
                 headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify(creatUser)
            };
            const response = await fetch('/createUser', requestOptions);
            const data = await response.json();
            if (data.redirectUrl) {
               window.location.href = data.redirectUrl;
            } else {
                document.getElementById('errorMessageCreate').innerText = data.ErrorMessage
            }
        

        })      

        async function getKompani(){
            let response = await fetch('/getKompani')
            let kompanis = await response.json()
            let kompaniTable = document.getElementById("komaniOption");
            kompanis.forEach(kompani => {
                let option = document.createElement("option");
                option.value = kompani.kompani;
                option.textContent = kompani.kompani;
                kompaniTable.appendChild(option);
            });
        }
        getKompani();
    </script>
</body>
</html>